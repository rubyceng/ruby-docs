---
Title: 高并发下的竞态插入问题
Draft: true
tags:
  - 数据库
  - ERP
Author: Ruby Ceng
---

## 前言

在公司写项目的时候遇到这样的场景：
有一个退款业务，系统内需要请求第三方支付中心，由第三方来实际发起退款，传递给第三方支付中心一个回调 url，无论结果成功或失败都由这个第三方的支付回调通知系统并修改对应单据状态。
但是在业务中，考虑到第三方回调可能会因为网络波动等问题丢失，因此在前端层面发起用户退款请求后，前端也会主动查询退款情况，在查询接口中，如果查询到退款已经成功，但是单据状态还是不变则是第三方的调用丢失，由这个查询来手动发起回调函数。


